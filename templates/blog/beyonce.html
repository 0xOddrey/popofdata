{% extends 'base.html' %}
{% load static %}

{% block title %}Beyonce Topic Modeling | Pop-of-Data{% endblock %}

{% block extra_css %}
<style>
    body {
        font-family: 'Open Sans', sans-serif;
        line-height: 1.7;
        color: #333;
        background: #f9f9f9;
    }

    header {
        background: #fff;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        position: fixed;
        width: 100%;
        top: 0;
        z-index: 1000;
    }

    nav {
        max-width: 1200px;
        margin: 0 auto;
        padding: 15px 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .logo {
        font-family: 'Montserrat', sans-serif;
        font-size: 24px;
        font-weight: 700;
        color: #e91e63;
        text-decoration: none;
    }

    main {
        max-width: 900px;
        margin: 100px auto 40px;
        padding: 0 20px;
    }

    .post-container {
        background: #fff;
        border-radius: 10px;
        box-shadow: 0 5px 30px rgba(0, 0, 0, 0.1);
        overflow: hidden;
    }

    .post-img {
        width: 100%;
        max-height: 500px;
        object-fit: cover;
    }

    .post-content {
        padding: 40px;
    }

    .post-title h1 {
        font-family: 'Montserrat', sans-serif;
        font-size: 36px;
        font-weight: 700;
        color: #222;
        margin-bottom: 15px;
    }

    .post-meta {
        color: #888;
        font-size: 14px;
        margin-bottom: 30px;
        display: flex;
        gap: 20px;
    }

    .post-meta i {
        margin-right: 5px;
        color: #e91e63;
    }

    .post-body p {
        margin-bottom: 20px;
        font-size: 16px;
    }

    .post-body h2 {
        font-family: 'Montserrat', sans-serif;
        font-size: 28px;
        font-weight: 600;
        color: #222;
        margin: 40px 0 20px;
        padding-bottom: 10px;
        border-bottom: 3px solid #e91e63;
    }

    .post-body h3 {
        font-family: 'Montserrat', sans-serif;
        font-size: 22px;
        font-weight: 600;
        color: #333;
        margin: 30px 0 15px;
    }

    pre {
        background: #2d2d2d;
        color: #f8f8f2;
        padding: 20px;
        border-radius: 8px;
        overflow-x: auto;
        margin: 20px 0;
        font-family: 'Courier New', monospace;
        font-size: 13px;
        line-height: 1.5;
    }

    code {
        font-family: 'Courier New', monospace;
    }

    .video-container {
        position: relative;
        padding-bottom: 56.25%;
        height: 0;
        overflow: hidden;
        margin: 30px 0;
        border-radius: 8px;
    }

    .video-container iframe {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        border: none;
        border-radius: 8px;
    }

    .topic-list {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: #fff;
        padding: 30px;
        border-radius: 8px;
        margin: 30px 0;
    }

    .topic-list h3 {
        color: #fff;
        margin-top: 0;
        margin-bottom: 20px;
    }

    .topic-item {
        background: rgba(255, 255, 255, 0.15);
        padding: 12px 15px;
        border-radius: 6px;
        margin-bottom: 10px;
        font-size: 14px;
    }

    .topic-item strong {
        color: #ffd700;
    }

    .conclusion {
        background: #f8f9fa;
        color: #333;
        padding: 30px;
        border-radius: 8px;
        margin: 30px 0;
        border-left: 4px solid #e91e63;
    }

    .conclusion h3 {
        color: #333;
        margin-top: 0;
        margin-bottom: 20px;
        font-family: 'Montserrat', sans-serif;
    }

    .conclusion p {
        color: #333;
    }

    .author-box {
        display: flex;
        gap: 20px;
        align-items: center;
        background: #f5f5f5;
        padding: 30px;
        border-radius: 8px;
        margin-top: 40px;
    }

    .author-img {
        width: 100px;
        height: 100px;
        border-radius: 50%;
        object-fit: cover;
    }

    .author-bio h4 {
        font-family: 'Montserrat', sans-serif;
        font-size: 18px;
        margin-bottom: 5px;
    }

    .author-bio p {
        color: #666;
        font-size: 14px;
        margin-bottom: 10px;
    }

    .author-social {
        display: flex;
        gap: 15px;
    }

    .author-social a {
        color: #333;
        font-size: 18px;
        transition: color 0.3s;
    }

    .author-social a:hover {
        color: #e91e63;
    }

    footer {
        background: #222;
        color: #fff;
        padding: 30px;
        text-align: center;
        margin-top: 40px;
    }

    footer p {
        font-size: 14px;
        color: #888;
    }

    footer .social-icons {
        margin-top: 15px;
    }

    footer .social-icons a {
        color: #fff;
        margin: 0 10px;
        font-size: 18px;
        transition: color 0.3s;
    }

    footer .social-icons a:hover {
        color: #e91e63;
    }

    @media (max-width: 768px) {
        .post-title h1 {
            font-size: 28px;
        }

        .post-content {
            padding: 25px;
        }

        .author-box {
            flex-direction: column;
            text-align: center;
        }
    }
</style>
{% endblock %}

{% block content %}
<header>
    <nav>
        <a href="{% url 'blog:home' %}" class="logo">Pop-of-Data</a>
    </nav>
</header>

<main>
    <article class="post-container">
        <img src="{% static 'images/beyonce.jpeg' %}" alt="Beyonce Topic Modeling" class="post-img">

        <div class="post-content">
            <div class="post-title">
                <h1>Beyonce Topic Modeling</h1>
            </div>

            <div class="post-meta">
                <span><i class="fa fa-user"></i> Audrey Taylor-Akwenye</span>
                <span><i class="fa fa-calendar"></i> April 21, 2019</span>
            </div>

            <div class="post-body">
                <p>Since 16 in her stilettos she's been strutting her stuff and producing original songs in all genres from Country to Rock! With the recent release of her Netflix documentary "Homecoming", fans have been looking back over the two-decade career of the Queen herself. Below is a breakdown of the major topic patterns that can be found throughout her songs.</p>

                <p>Latent Dirichlet Allocation (LDA) is a model that analyzes large documents of text and then drills down on major topics. I used the Gensim package to analyze all Beyonce song lyrics including her latest album with her hubby Jay Z.</p>

                <p>I was able to compile all the lyrics for Beyonce from a larger dataset of over 380,000 lyrics from Metro Lyrics. Because the dataset was too large, I had to host the csv file on AWS S3. This gave me a total of 137 songs.</p>

                <div class="video-container">
                    <iframe src="https://www.youtube.com/embed/fB8qvx0HOlI" title="YouTube video player" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                </div>

                <p>Using pyLDAvis, we can see the 30 most salient terms from Beyonce's Lyrics.</p>

                <h2>The Code</h2>

                <h3>Build Bigrams and Trigrams</h3>
                <p>Bigrams look at the two words before and after a word to pull out some context. Trigrams do the same but for the three words before and after. We also have to remove stop words. These are commonly used words that don't really add to the context of a text.</p>

                <pre><code># Build the bigram and trigram models
bigram = gensim.models.Phrases(data_words, min_count=5, threshold=100)
trigram = gensim.models.Phrases(bigram[data_words], threshold=100)

# Faster way to get a sentence clubbed as a trigram/bigram
bigram_mod = gensim.models.phrases.Phraser(bigram)
trigram_mod = gensim.models.phrases.Phraser(trigram)

def remove_stopwords(texts):
    return [[word for word in simple_preprocess(str(doc))
             if word not in stop_words] for doc in texts]

def make_bigrams(texts):
    return [bigram_mod[doc] for doc in texts]

def make_trigrams(texts):
    return [trigram_mod[bigram_mod[doc]] for doc in texts]

def lemmatization(texts, allowed_postags=['NOUN', 'ADJ', 'VERB', 'ADV']):
    """https://spacy.io/api/annotation"""
    texts_out = []
    for sent in texts:
        doc = nlp(" ".join(sent))
        texts_out.append([token.lemma_ for token in doc
                          if token.pos_ in allowed_postags])
    return texts_out</code></pre>

                <h3>Remove Stop Words</h3>
                <p>Next we create the corpus. We use doc to bag-of-words to encode each word in the lyrics.</p>

                <pre><code>id2word = corpora.Dictionary(data_lemmatized)
texts = data_lemmatized
corpus = [id2word.doc2bow(text) for text in texts]
[[(id2word[id], freq) for id, freq in cp] for cp in corpus[:1]]</code></pre>

                <h3>Run the LDA Model</h3>
                <p>Using gensim, I build the lda_model which will create 10 topics. The 10 passes means the lda model will go through the lyrics 10 times to improve the Coherence Value.</p>

                <pre><code>lda_model = gensim.models.ldamodel.LdaModel(
    corpus=corpus,
    id2word=id2word,
    num_topics=10,
    random_state=100,
    update_every=1,
    chunksize=100,
    passes=10,
    alpha='auto',
    per_word_topics=True
)</code></pre>

                <h3>Get LDA Model Coherence Scores</h3>
                <p>Next we use LDA Mallet to generate coherence scores for our lda model. After working around to get the optimal number of topics, we get 14 topics that are shown below.</p>

                <pre><code># Show Topics
pprint(ldamallet.show_topics(formatted=False))

# Compute Coherence Score
coherence_model_ldamallet = CoherenceModel(
    model=ldamallet,
    texts=data_lemmatized,
    dictionary=id2word,
    coherence='c_v'
)
coherence_ldamallet = coherence_model_ldamallet.get_coherence()
print('\nCoherence Score: ', coherence_ldamallet)</code></pre>

                <h3>Interpret the Results</h3>
                <p>Interpreting the topics is actually the most difficult part of topic modeling because it takes a little domain knowledge. My interpretation is below:</p>

                <div class="topic-list">
                    <h3>Beyonce's 14 Song Topics</h3>
                    <div class="topic-item"><strong>0: "I'm a Hustler"</strong> — big, back, talk, upgrade, good, hustler, call, strong, tough, diva</div>
                    <div class="topic-item"><strong>1: "I will fight you"</strong> — hand, hold, man, daddy, side, smack, air, care, said_shoot, put</div>
                    <div class="topic-item"><strong>2: "I'm independent"</strong> — girl, freedom, wanna, make, fall, kind, baby, dress, daddy, club</div>
                    <div class="topic-item"><strong>3: "I rep my crew"</strong> — make, pull, leave, real, friend, die, boss, bad, gon, jump</div>
                    <div class="topic-item"><strong>4: "Girl Power"</strong> — girl, run, world, motha, catch, boy, pray, bring, play, check</div>
                    <div class="topic-item"><strong>5: "I slay"</strong> — slay, make, good, lady, flawless, ride, teach, rock, bitch, hard</div>
                    <div class="topic-item"><strong>6: "Don't Play Me"</strong> — work, hurt, ring, lie, money, beautiful, give, back, start, cry</div>
                    <div class="topic-item"><strong>7: "S*xual Relations"</strong> — turn, cherry, feel, til, wait, stand, morning, home, time, stop_lov</div>
                    <div class="topic-item"><strong>8: "I'm the Queen"</strong> — life, town, care, live, bow, ground, forget, watch, man</div>
                    <div class="topic-item"><strong>9: "Leave Something Behind"</strong> — baby, put, top, time, day, make, boy, whatev, stay, immortal</div>
                    <div class="topic-item"><strong>10: "I like to Party"</strong> — wanna, tonight, babe, body, baby, show, rock, feel, move, dance</div>
                    <div class="topic-item"><strong>11: "I'm crazy"</strong> — love, crazy, baby, break, feel, hop, touch, make, jealous, promise</div>
                    <div class="topic-item"><strong>12: "You cheat, You Crazy"</strong> — good, hear, put, lose, wanna, thing, time, face, boy, thinking_bout</div>
                    <div class="topic-item"><strong>13: "But I Love you"</strong> — love, night, light, baby, kiss, long, rub, feel, boy, sweet</div>
                </div>

                <div class="conclusion">
                    <h3>Conclusion</h3>
                    <p>Through topic modeling, we can see that Beyonce's music covers a wide range of themes from empowerment and independence to love and relationships. Her most common topics center around being strong, independent, and in control.</p>
                </div>

                <div class="author-box">
                    <img src="{% static 'images/IMG_0601.jpg' %}" alt="Audrey Taylor-Akwenye" class="author-img">
                    <div class="author-bio">
                        <h4>Audrey Taylor-Akwenye</h4>
                        <p>Data Scientist, Educator, Entrepreneur</p>
                        <div class="author-social">
                            <a href="https://x.com/0xoddrey" target="_blank"><i class="fa fa-twitter"></i></a>
                            <a href="https://github.com/0xoddrey" target="_blank"><i class="fa fa-github"></i></a>
                            <a href="https://www.instagram.com/audreyakwenye" target="_blank"><i class="fa fa-instagram"></i></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </article>
</main>

<footer>
    <p>&copy; Pop-of-Data. 2019 All Rights Reserved</p>
    <div class="social-icons">
        <a href="https://x.com/0xoddrey" target="_blank"><i class="fa fa-twitter"></i></a>
        <a href="https://www.instagram.com/audreyakwenye" target="_blank"><i class="fa fa-instagram"></i></a>
    </div>
</footer>
{% endblock %}
